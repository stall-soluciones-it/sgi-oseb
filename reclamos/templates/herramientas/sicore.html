{% extends 'reclamos/base.html' %}

{% block content %}
<div class="content container">
    <div class="row">
        <div class="col-md-8">
            <div class="reclamo">
                <p><b>Generación de archivos SICORE con datos DB SISA:</b></p>
                <br>
                <p>Ingrese el período a generar. Aguarde que termine el proceso y a continuación</p>
                <p>se descargará un archivo ZIP conteniendo los archivos resultantes.</p>
                <p>En caso de error solo se descargará un log informando el mismo.</p>
                <br>
                
                <form method="post" enctype="multipart/form-data" novalidate>
                    {% csrf_token %}
                    
                    <div class="form-group">
                        <label for="quincena">Quincena: <span style="color: red;">*</span></label>
                        <select name="quincena" id="quincena" required>
                            <option value="">Seleccione una quincena</option>
                            <option value="1">1ra Quincena (1 al 15)</option>
                            <option value="2">2da Quincena (16 al final)</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="mes">Mes: <span style="color: red;">*</span></label>
                        <select name="mes" id="mes" required>
                            <option value="">Seleccione un mes</option>
                            <option value="1">Enero</option>
                            <option value="2">Febrero</option>
                            <option value="3">Marzo</option>
                            <option value="4">Abril</option>
                            <option value="5">Mayo</option>
                            <option value="6">Junio</option>
                            <option value="7">Julio</option>
                            <option value="8">Agosto</option>
                            <option value="9">Septiembre</option>
                            <option value="10">Octubre</option>
                            <option value="11">Noviembre</option>
                            <option value="12">Diciembre</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="anio">Año: <span style="color: red;">*</span></label>
                        <input type="number" 
                               name="anio" 
                               id="anio" 
                               min="2020" 
                               max="2040" 
                               value="{{ current_year|default:'2025' }}"
                               placeholder="Ej: 2025"
                               required/>
                        <small>Rango válido: 2020 - 2040</small>
                    </div>
                    
                    <div class="form-group">
                        <input type="submit" value="Generar Archivos"/>
                    </div>
                </form>
                
                <script>
                // Establecer mes y año actuales por defecto
                document.addEventListener('DOMContentLoaded', function() {
                    const fecha = new Date();
                    const mesActual = fecha.getMonth() + 1;
                    const anioActual = fecha.getFullYear();
                    
                    // Preseleccionar mes actual si está en el rango
                    const selectMes = document.getElementById('mes');
                    if (selectMes.querySelector(`option[value="${mesActual}"]`)) {
                        selectMes.value = mesActual;
                    }
                    
                    // Establecer año actual si está en el rango
                    const inputAnio = document.getElementById('anio');
                    if (anioActual >= 2020 && anioActual <= 2040) {
                        inputAnio.value = anioActual;
                    }
                    
                    // Validación adicional en el cliente
                    document.querySelector('form').addEventListener('submit', function(e) {
                        const quincena = document.getElementById('quincena').value;
                        const mes = document.getElementById('mes').value;
                        const anio = document.getElementById('anio').value;
                        
                        if (!quincena || !mes || !anio) {
                            e.preventDefault();
                            alert('Por favor, complete todos los campos obligatorios.');
                            return false;
                        }
                        
                        if (anio < 2020 || anio > 2040) {
                            e.preventDefault();
                            alert('El año debe estar entre 2020 y 2040.');
                            return false;
                        }
                    });
                });
                </script>
            </div>
        </div>
    </div>
</div>
{% endblock %}
