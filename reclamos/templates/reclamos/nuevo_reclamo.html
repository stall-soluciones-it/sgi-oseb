{% extends 'reclamos/base.html' %}
{% load static %}

{% block content %}
    <title>Nuevo reclamo</title>

    {% if perms.reclamos.editar_reclamo or perms.reclamos.gsa %}
        <h2>Nuevo Trabajo:</h2>

        <table>
            <tr>
                <td class="editar_reclamo" style="vertical-align:top; width:50%;">
                    <p><b>Cargar reclamo:</b></p>
                    <form method="POST" enctype="multipart/form-data" class="post-form">
                        {% csrf_token %}
                        <table class="nuevo_reclamo">
                            {{ rec_form.as_table }}
                        </table>
                        <p style="color:white">-</p>
                        <button type="submit" class="btn btn-default"><b>Guardar</b></button>
                    </form>
                </td>

                <td class="editar_reclamo" style="vertical-align:top; width:50%;">
                    <p><b>Buscador</b>
                        <span style="font-size:11px; color:red">
                            (*cuentas en rojo tienen trabajos realizados o pendientes)
                        </span>
                    </p>

                    <!-- Campo de búsqueda -->
                    <div class="form-group">
                        <input type="text"
                               id="buscar-partida"
                               class="form-control"
                               placeholder="Buscar por dirección o nombre... (mínimo 3 caracteres)"
                               autocomplete="off"
                               style="width: 100%; padding: 8px; font-size: 14px; border: 1px solid #ccc; border-radius: 4px;">
                    </div>

                    <!-- Mensajes -->
                    <div id="mensaje-busqueda"></div>

                    <!-- Contenedor de resultados -->
                    <div id="resultados-partidas" style="max-height: 500px; overflow-y: auto; margin-top: 10px;"></div>
                </td>
            </tr>
        </table>

        <!-- Estilos específicos de esta página -->
        <style>
            .loading-spinner {
                padding: 20px;
                font-size: 16px;
                color: #337ab7;
            }

            .glyphicon-spin {
                animation: spin 1s infinite linear;
            }

            @keyframes spin {
                from { transform: rotate(0deg); }
                to { transform: rotate(360deg); }
            }

            .campo-actualizado {
                background-color: #d4edda !important;
                transition: background-color 0.5s ease;
            }

            .unidad-con-trabajo {
                color: red !important;
                font-weight: bold;
            }

            #tabla-partidas {
                font-size: 13px;
                width: 100%;
            }

            #tabla-partidas tbody tr:hover {
                background-color: #f5f5f5;
            }

            #tabla-partidas thead {
                background-color: #337ab7;
                color: white;
            }

            #tabla-partidas thead th {
                padding: 8px;
                text-align: left;
            }

            #tabla-partidas tbody td {
                padding: 6px 8px;
            }

            #tabla-partidas tbody tr.info {
                background-color: #d9edf7 !important;
            }
        </style>
    {% endif %}

    <br><br><br><br>
{% endblock %}

{% block additional_scripts %}
    <!-- Módulo de búsqueda AJAX de partidas -->
    <script src="{% static 'js/buscador_partidas.js' %}"></script>
{% endblock %}
