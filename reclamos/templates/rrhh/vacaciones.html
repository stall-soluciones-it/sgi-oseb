{% extends 'reclamos/base.html' %}

{% block content %}
{% if perms.reclamos.rrhh %}
<div class="content container">
    <div class="row">
        <div class="col-md-8">
            <div class="reclamo">
                <title>Vacaciones</title>
                <h2>Vacaciones</h2>
                
                <!-- Filtro de empleados -->
                <div style="margin-bottom: 15px;">
                    <label for="filtroEmpleados">Mostrar: </label>
                    <select id="filtroEmpleados" onchange="filtrarEmpleados()">
                        <option value="todos">Todos</option>
                        <option value="activos">Activos</option>
                        <option value="baja">Baja</option>
                    </select>
                </div>
                
                <table class="sortable">
                    <tr>
                        <th>
                            <div class="th_tipo">
                                NÂº Legajo
                            </div>
                        </th>
                        <th>
                            <div class="th_material">
                                Nombre
                            </div>
                        </th>
                        <th>
                            <div class="th_cod_mat">
                                Cuil
                            </div>
                        </th>
                        <th>
                            <div class="th_fecha">
                                Fecha Ingreso
                            </div>
                        </th>
                        <th>
                            <div class="th_tipo">
                                Vacaciones pendientes
                            </div>
                        </th>
                    </tr>
                    {% for empleado in empleados %}
                    <tr class="fila-empleado" data-estado="{% if empleado.fecha_egreso %}baja{% else %}activo{% endif %}">
                        <td>
                            <div class="td_tipo">
                                <a href="{% url 'detalle_empleado' pk=empleado.pk %}">{{ empleado.n_legajo|default_if_none:"-" }}</a>
                            </div>
                        </td>
                        <td>
                            <div class="td_material">
                                <span {% if empleado.fecha_egreso %}style="color: red;"{% endif %}>{{ empleado.nombre|default_if_none:"-" }}</span>
                            </div>
                        </td>
                        <td>
                            <div class="td_cod_mat">
                                {{ empleado.cuil|default_if_none:"-" }}
                            </div>
                        </td>
                        <td>
                            <div class="td_fecha">
                                {{ empleado.fecha_ingreso|date:'d-m-y' }}
                            </div>
                        </td>
                        <td>
                            <div class="td_tipo">
                                {{ empleado.restan|default_if_none:"-" }}
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </table>
                <br>
                <br>
                <br>
                <br>
            </div>
        </div>
    </div>
</div>

<script>
function filtrarEmpleados() {
    var filtro = document.getElementById('filtroEmpleados').value;
    var filas = document.getElementsByClassName('fila-empleado');
    
    for (var i = 0; i < filas.length; i++) {
        var estado = filas[i].getAttribute('data-estado');
        
        if (filtro === 'todos') {
            filas[i].style.display = '';
        } else if (filtro === 'activos' && estado === 'activo') {
            filas[i].style.display = '';
        } else if (filtro === 'baja' && estado === 'baja') {
            filas[i].style.display = '';
        } else {
            filas[i].style.display = 'none';
        }
    }
}
</script>

{% endif %}
{% endblock %}
